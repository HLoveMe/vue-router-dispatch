!function(e,r){"object"==typeof exports&&"object"==typeof module?module.exports=r(require("vue-router"),require("rxjs"),require("rxjs/operators"),require("vue")):"function"==typeof define&&define.amd?define(["vue-router","rxjs","rxjs/operators","vue"],r):"object"==typeof exports?exports.Pin=r(require("vue-router"),require("rxjs"),require("rxjs/operators"),require("vue")):e.Pin=r(e["vue-router"],e.rxjs,e["rxjs/operators"],e.vue)}(self,((e,r,t,n)=>(()=>{"use strict";var o={832:e=>{e.exports=r},597:e=>{e.exports=t},748:e=>{e.exports=n},557:r=>{r.exports=e}},u={};function i(e){var r=u[e];if(void 0!==r)return r.exports;var t=u[e]={exports:{}};return o[e](t,t.exports,i),t.exports}i.d=(e,r)=>{for(var t in r)i.o(r,t)&&!i.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:r[t]})},i.o=(e,r)=>Object.prototype.hasOwnProperty.call(e,r),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var c={};return(()=>{i.r(c),i.d(c,{VueRouterPin:()=>q,dispatchEvent:()=>T,useRoutePin:()=>D,useRouterPin:()=>M});var e=i(557),r=i(832);function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t(e)}function n(){}var o="function"==typeof Symbol&&"symbol"===t(Symbol.toStringTag),u=function(e){return o?Symbol.for("[r-server]: "+e):"[r-server]: "+e},a=u("event-init"),l=u("GlobalRServerKey"),f=u("CurrentRServerKey"),s=new Map,p={type:a,data:null,reject:n,resolve:n,source:void 0},v={id:"",channelCenter:new r.BehaviorSubject(p),errorChanel:new r.Subject,children:[],clearSubs:[]},b={id:l,router:void 0,children:[],channelCenter:new r.BehaviorSubject(p),errorChanel:new r.Subject,clearSubs:[]},y=function(){console.error("please install vue-router-pin")},d={on:y,onBehavior:y,once:y,onError:y,dispatch:y,dispatchAsync:y},h=i(597),m=i(748);function j(e){return function(e){if(Array.isArray(e))return g(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,r){if(e){if("string"==typeof e)return g(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?g(e,r):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function g(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function S(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function x(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?S(Object(t),!0).forEach((function(r){P(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):S(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function P(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}var O=function(e){var t={},n=e.fullPath,o=u(n),i=s.get(o);return i?t=i:(t.id=u(e.fullPath),t.route=e,t.children=[],t.clearSubs=[],t.channelCenter=new r.BehaviorSubject(p)),t},w=function(e,r){return r instanceof RegExp?"string"==typeof e.type&&r.test(e.type):e.type===r},C=(0,m.shallowRef)(v);function E(e,r){r.unsubscribe();var t=e.clearSubs.indexOf(r);t>-1&&(e.clearSubs=e.clearSubs.splice(t,1))}function R(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=e.channelCenter,u=e.id,i=e.errorChanel,c=u===l;if(!1===n)return o.next(t),void(c&&e.children.forEach((function(e){return e.channelCenter.next(t)})));var a=t.resolve,f=t.reject,s=(0,r.from)(new Promise((function(e,r){o.next(x(x({},t),{},{resolve:e,reject:r}))}))),p=e.children.map((function(e){return(0,r.from)(new Promise((function(r,n){e.channelCenter.next(x(x({},t),{},{resolve:r,reject:n}))})))}));r.zip.apply(void 0,[s].concat(j(p))).pipe((0,h.takeLast)(1)).subscribe({next:function(e){return a(e)},complete:function(){},error:function(e){f(e),i.next(e)}})}var A=function(e,r){var t=b.router,n=function(r){if(0==!!r)return e;if(e.id!==l)return e;var n=t.resolve(r).fullPath,o=u(n);return s.get(o)||e};return{dispatch:function(e,t,o){R(n(o),{type:e,data:t,source:r,resolve:function(){},reject:function(){}})},dispatchAsync:function(e,t,o){return new Promise((function(u,i){R(n(o),{type:e,data:t,source:r,resolve:function(e){return u(e)},reject:function(e){return i(e)}},!0)}))},on:function(r,t){return function(e,r,t){var n=e.channelCenter,o=e.errorChanel,u=n.pipe((0,h.filter)((function(e){return w(e,r)||e.type===a})),(0,h.bufferCount)(2,1),(0,h.map)((function(e){return e[1]}))).subscribe({complete:function(){return E(e,u)},next:function(e){return t&&t(e)},error:function(e){return o.next(e)}});return e.clearSubs.push(u),{close:function(){return E(e,u)}}}(e,r,t)},onBehavior:function(r,t){return function(e,r,t){var n=e.channelCenter,o=e.errorChanel,u=n.pipe((0,h.filter)((function(e){return w(e,r)&&e.type!==a}))).subscribe({complete:function(){return E(e,u)},next:function(e){return t&&t(e)},error:function(e){return o.next(e)}});return e.clearSubs.push(u),{close:function(){return E(e,u)}}}(e,r,t)},once:function(r,t){return function(e,r,t){var n=e.channelCenter,o=e.errorChanel,u=n.pipe((0,h.filter)((function(e){return w(e,r)||e.type===a})),(0,h.bufferCount)(2,1),(0,h.map)((function(e){return e[1]})),(0,h.take)(1)).subscribe({complete:function(){return E(e,u)},next:function(e){return t&&t(e)},error:function(e){return o.next(e)}});return e.clearSubs.push(u),{close:function(){return E(e,u)}}}(e,r,t)},onError:function(r){!function(e,r){var t=e.errorChanel.subscribe({complete:function(){E(e,t)},next:function(e){r&&r(e)}});e.clearSubs.push(t)}(e,r)}}};const q=(B={install:function(t){var n;(n=t.config.globalProperties.$router).beforeEach((function(e,r){var t=O(e);s.has(t.id)||b.children.push(t),s.set(t.id,t),C.value=t})),n.afterEach((function(e,r){C.value=O(e)})),b.channelCenter=new r.BehaviorSubject(p),b.router=n,s.set(b.id,b),C.value=b,t.provide(l,b),t.provide(f,C),t.config.globalProperties.$rs=function(r,t){R(C.value,{type:r,data:t,source:(0,e.useRoute)(),resolve:function(){},reject:function(){}})}},dispatch:function(e,r){var t=!1,o=void 0;2==(arguments.length<=2?0:arguments.length-2)?(t=arguments.length<=2?void 0:arguments[2],o=arguments.length<=3?void 0:arguments[3]):1==(arguments.length<=2?0:arguments.length-2)&&("boolean"==typeof(arguments.length<=2?void 0:arguments[2])?(t=arguments.length<=2?void 0:arguments[2],o=void 0):(o=arguments.length<=2?void 0:arguments[2],t=!1));var i=void 0;if(0==!!o&&(i=b),o===b.router)i=b;else{var c=b.router,a=c.resolve(o),l=a.fullPath,f=u(l);i=s.get(f)}return new Promise((function(o,u){R(i,{type:e,data:r,source:void 0,resolve:t?o:n,reject:t?u:n},!!t),t||o(null)}))}},B);var B;function D(){var r=(0,m.inject)(f);return r?A(r.value,(0,e.useRoute)()):d}function M(){var r=(0,m.inject)(l);return r?A(r,(0,e.useRouter)()):d}function T(e,r,t,n){return q.dispatch(e,r,t,n)}})(),c})()));