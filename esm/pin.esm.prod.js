!function(e,r){"object"==typeof exports&&"object"==typeof module?module.exports=r(require("rxjs"),require("rxjs/operators"),require("vue"),require("vue-router")):"function"==typeof define&&define.amd?define(["rxjs","rxjs/operators","vue","vue-router"],r):"object"==typeof exports?exports.Pin=r(require("rxjs"),require("rxjs/operators"),require("vue"),require("vue-router")):e.Pin=r(e.rxjs,e["rxjs/operators"],e.vue,e["vue-router"])}(self,((e,r,n,t)=>(()=>{"use strict";var o={643:function(e,r,n){var t=this&&this.__assign||function(){return t=Object.assign||function(e){for(var r,n=1,t=arguments.length;n<t;n++)for(var o in r=arguments[n])Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o]);return e},t.apply(this,arguments)},o=this&&this.__spreadArray||function(e,r,n){if(n||2===arguments.length)for(var t,o=0,u=r.length;o<u;o++)!t&&o in r||(t||(t=Array.prototype.slice.call(r,0,o)),t[o]=r[o]);return e.concat(t||Array.prototype.slice.call(r))};r.__esModule=!0,r.createRxFunc=void 0;var u=n(832),i=n(597),c=n(557),a=n(936),l=n(748),s=function(e){var r={},n=e.fullPath,t=(0,a.PolySymbol)(n),o=a.ServerMap.get(t);return o?r=o:(r.id=(0,a.PolySymbol)(e.fullPath),r.route=e,r.children=[],r.clearSubs=[],r.channelCenter=new u.BehaviorSubject(a.initEvent)),r},v=function(e,r){return r instanceof RegExp?"string"==typeof e.type&&r.test(e.type):e.type===r},f=(0,l.shallowRef)(a.SHALL_CURRENT);function p(e,r){r&&r.unsubscribe();var n=e.clearSubs.indexOf(r);n>-1&&e.clearSubs.splice(n,1)}function b(e,r,n){void 0===n&&(n=!1);var c=e.channelCenter,l=e.id,s=e.errorChanel,v=l===a.GlobalRServerKey;if(!1===n)return c.next(r),void(v&&e.children.forEach((function(e){return e.channelCenter.next(r)})));var f=r.resolve,p=r.reject,b=(0,u.from)(new Promise((function(e,n){c.next(t(t({},r),{resolve:e,reject:n}))}))),y=e.children.map((function(e){return(0,u.from)(new Promise((function(n,o){e.channelCenter.next(t(t({},r),{resolve:n,reject:o}))})))}));u.zip.apply(void 0,o([b],y,!1)).pipe((0,i.takeLast)(1)).subscribe({next:function(e){return f(e)},complete:function(){},error:function(e){p(e),s.next(e)}})}r.createRxFunc=function(e,r){var n=a.Global_Serve.router,t=function(r){if(0==!!r)return e;if(e.id!==a.GlobalRServerKey)return e;var t=n.resolve(r).fullPath,o=(0,a.PolySymbol)(t);return a.ServerMap.get(o)||e};return{dispatch:function(e,n,o){b(t(o),{type:e,data:n,source:r,resolve:function(){},reject:function(){}})},dispatchAsync:function(e,n,o){return new Promise((function(u,i){b(t(o),{type:e,data:n,source:r,resolve:function(e){return u(e)},reject:function(e){return i(e)}},!0)}))},on:function(r,n){return function(e,r,n){var t=e.channelCenter,o=e.errorChanel,u=t.pipe((0,i.filter)((function(e){return v(e,r)||e.type===a.initEventKey})),(0,i.bufferCount)(2,1),(0,i.map)((function(e){return e[1]}))).subscribe({complete:function(){return p(e,u)},next:function(e){return n&&n(e)},error:function(e){return o.next(e)}});return e.clearSubs.push(u),{close:function(){return p(e,u)}}}(e,r,n)},onBehavior:function(r,n){return function(e,r,n){var t=e.channelCenter,o=e.errorChanel,u=t.pipe((0,i.filter)((function(e){return v(e,r)&&e.type!==a.initEventKey}))).subscribe({complete:function(){return p(e,u)},next:function(e){return n&&n(e)},error:function(e){return o.next(e)}});return e.clearSubs.push(u),{close:function(){return p(e,u)}}}(e,r,n)},once:function(r,n){return function(e,r,n){var t=e.channelCenter,o=e.errorChanel,u=t.pipe((0,i.filter)((function(e){return v(e,r)||e.type===a.initEventKey})),(0,i.bufferCount)(2,1),(0,i.map)((function(e){return e[1]})),(0,i.take)(1)).subscribe({complete:function(){return p(e,u)},next:function(e){return n&&n(e)},error:function(e){return o.next(e)}});return e.clearSubs.push(u),{close:function(){return p(e,u)}}}(e,r,n)},onError:function(r){return function(e,r){var n=e.errorChanel.subscribe({complete:function(){p(e,n)},next:function(e){r&&r(e)}});return e.clearSubs.push(n),{close:function(){return p(e,n)}}}(e,r)}}};var y=function(){var e={install:function(e){var r;(r=e.config.globalProperties.$router).beforeEach((function(e,r){var n=s(e);a.ServerMap.has(n.id)||a.Global_Serve.children.push(n),a.ServerMap.set(n.id,n),f.value=n})),r.afterEach((function(e,r){f.value=s(e)})),a.Global_Serve.channelCenter=new u.BehaviorSubject(a.initEvent),a.Global_Serve.router=r,a.ServerMap.set(a.Global_Serve.id,a.Global_Serve),f.value=a.Global_Serve,e.provide(a.GlobalRServerKey,a.Global_Serve),e.provide(a.CurrentRServerKey,f),e.config.globalProperties.$rs=function(e,r){b(f.value,{type:e,data:r,source:(0,c.useRoute)(),resolve:function(){},reject:function(){}})}},dispatch:function(e,r){for(var n=[],t=2;t<arguments.length;t++)n[t-2]=arguments[t];var o=!1,u=void 0;2===(n=n.filter((function(e){return void 0!==e}))).length?(o=n[0],u=n[1]):1===n.length?"boolean"==typeof n[0]?(o=n[0],u=void 0):(u=n[0],o=!1):(u=void 0,o=!1);var i=void 0;if(0==!!u)i=a.Global_Serve;else{var c=a.Global_Serve.router,l=c.resolve(u).fullPath,s=(0,a.PolySymbol)(l);i=a.ServerMap.get(s)}return new Promise((function(n,t){b(i,{type:e,data:r,source:void 0,resolve:o?n:a.noop,reject:o?t:a.noop},!!o),o||n(null)}))}};return e}();r.default=y},607:function(e,r,n){var t=this&&this.__createBinding||(Object.create?function(e,r,n,t){void 0===t&&(t=n);var o=Object.getOwnPropertyDescriptor(r,n);o&&!("get"in o?!r.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return r[n]}}),Object.defineProperty(e,t,o)}:function(e,r,n,t){void 0===t&&(t=n),e[t]=r[n]}),o=this&&this.__setModuleDefault||(Object.create?function(e,r){Object.defineProperty(e,"default",{enumerable:!0,value:r})}:function(e,r){e.default=r}),u=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var r={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&t(r,e,n);return o(r,e),r};r.__esModule=!0,r.dispatchEvent=r.useRouterPin=r.useRoutePin=r.VueRouterPin=void 0;var i=n(557),c=n(936),a=u(n(643));r.VueRouterPin=a.default;var l=n(748);r.useRoutePin=function(){var e=(0,l.inject)(c.CurrentRServerKey);return e?(0,a.createRxFunc)(e.value,(0,i.useRoute)()):c.EmptyPin},r.useRouterPin=function(){var e=(0,l.inject)(c.GlobalRServerKey);return e?(0,a.createRxFunc)(e,(0,i.useRouter)()):c.EmptyPin},r.dispatchEvent=function(e,r,n,t){return a.default.dispatch(e,r,n,t)}},936:(e,r,n)=>{r.__esModule=!0,r.EmptyPin=r.noop=r.PolySymbol=r.initEventKey=r.initEvent=r.ServerMap=r.Global_Serve=r.SHALL_CURRENT=r.CurrentRServerKey=r.GlobalRServerKey=void 0;var t=n(832);function o(){}r.noop=o;var u="function"==typeof Symbol&&"symbol"==typeof Symbol.toStringTag,i=function(e){return u?Symbol.for("[r-server]: "+e):"[r-server]: "+e};r.PolySymbol=i;var c=i("event-init");r.initEventKey=c;var a=i("GlobalRServerKey");r.GlobalRServerKey=a;var l=i("CurrentRServerKey");r.CurrentRServerKey=l;var s=new Map;r.ServerMap=s;var v={type:c,data:null,reject:o,resolve:o,source:void 0};r.initEvent=v;var f={id:"",channelCenter:new t.BehaviorSubject(v),errorChanel:new t.Subject,children:[],clearSubs:[]};r.SHALL_CURRENT=f;var p={id:a,router:void 0,children:[],channelCenter:new t.BehaviorSubject(v),errorChanel:new t.Subject,clearSubs:[]};r.Global_Serve=p;var b=function(){console.error("please install vue-router-pin")},y={on:b,onBehavior:b,once:b,onError:b,dispatch:b,dispatchAsync:b};r.EmptyPin=y},832:r=>{r.exports=e},597:e=>{e.exports=r},748:e=>{e.exports=n},557:e=>{e.exports=t}},u={};return function e(r){var n=u[r];if(void 0!==n)return n.exports;var t=u[r]={exports:{}};return o[r].call(t.exports,t,t.exports,e),t.exports}(607)})()));